<!DOCTYPE HTML>
<html>
  <head>
    <title>Blog of Ryan Bigg - Home</title>
    <link href="http://feeds.feedburner.com/ryanbigg" rel="alternate" title="The Life of a Radar" type="application/atom+xml" />
    <link rel='stylesheet' href='/css/style.css' media='screen'>
    <link rel='stylesheet' href='/css/mobile.css'>
  <body>
    <h1 align='center'>The Life of a Radar</h1>
    <div id='page'>
      <div id="header">
        <p>Hi there, my parents and friends call me Ryan Bigg, but you may know me as "Radar". Either is fine.</p>
        <p>I'm a technical writer for Ruby / Rails based in Australia. I have written a Rails book with <a href="http://yehudakatz.com">Yehuda Katz</a> called <a href="http://manning.com/katz">Rails 3 in Action</a>, which is available also on <a href='http://www.amazon.com/Rails-3-Action-Ryan-Bigg/dp/1935182277'>Amazon</a>.
        </p>

        <div id="more">
          <p>
          I won a <a href='http://rubyheroes.com'>Ruby Hero</a> award in 2011 for my work on documentation for Rails. I keep some guides in my <a href='http://github.com/radar/guides'>guides</a> repository on GitHub. As part of this documentation, I've worked on the <a href='http://guides.rubyonrails.org/asset_pipeline.html'>Asset Pipeline</a>, <a href='http://guides.rubyonrails.org/active_record_querying.html'>Active Record Query Interface</a>, <a href='http://guides.rubyonrails.org/configuring.html'>Configuring Rails Applications</a>, <a href='http://guides.rubyonrails.org/engines.html'>Getting Started with Engines</a> and the <a href='http://guides.rubyonrails.org/initialization.html'>Rails Initialization Internals</a> guides. I've also been known to hang out on <a href='http://stackoverflow.com/users/15245/ryan-bigg'>Stack Overflow</a>.
          </p>
          <p><strong>If you're a recruiter, thanks but no thanks. Please do not contact me.</strong></p>
          <p> Occasionally I find some time to write interesting blog posts such as the ones you see below.</p>
          <p>I also have done quite a lot of <a href="http://github.com/radar">open-source work</a> and I <a href="http://twitter.com/ryanbigg">tweet</a>. Find out more <a href="http://ryanbigg.com/about-me">about me</a>.</p> 
          <p>If you like what you see you can <a href='http://feeds.feedburner.com/ryanbigg'>subscribe to this blog</a>.</p>
          <p><small>Oh, and I once beat <a href='https://twitter.com/dhh/status/81987522766450688'>DHH</a> in an <a href='https://twitter.com/ryanbigg/status/81988004947828736'>argument</a>.</small></p>
        </div>
      </div>
      <header></header>
      

<!-- Layout inspired by Nick Quaranto's "Litany Against Fear" blog 
     http://litanyagainstfear.com -->
<div id='page'>
  <article>
    <a href="/2012/03/engines-and-authentication"><header>Engines and Authentication</header></a>
    <small>03 Mar 2012</small><br>
    <p>I&#8217;ve been in America now longer than I&#8217;ve been in my new apartment, but it&#8217;s for very good reasons. The first of these was <a href='http://spreeconf.com'>SpreeConf</a>, which was held in New York City and the second was <a href='http://ruby.onales.com'>Ruby
on Ales</a>, held in Bend, Oregon. Both were amazing conferences for their own reasons.</p>

<p>At both of these conferences, I gave a talk about Rails Engines. In this talk, I covered a lot of the lessons that I learned about developing an engine, and the one of them that I would like to expand on today is about how an engine should deal with authentication.</p>

<p>Put simply, the engine should not deal with authentication <em>at all</em>. You can stop reading now, this blog post is over and you&#8217;ve learned everything you&#8217;re going to learn. Go forth and develop engines without authentication. Thanks for reading!</p>
<hr />
<p>If you&#8217;re staying for after-the-fold, then let me explain my reasonings for this.</p>

<p>When we (Phil Arndt, Josh Adams and I) were developing <a href='https://github.com/radar/forem'>Forem</a>, we talked about what authentication engine we would support inside Forem. The issue was that different people have different opinions on what authentication system is &#8220;best&#8221;. Some like <a href='https://github.com/technoweenie/restful-authentication'>Restful Authentication</a>, some like <a href='https://github.com/binarylogic/authlogic'>Authlogic</a>, others like <a href='https://github.com/thoughtbot/clearance'>Clearance</a>, others like <a href='https://github.com/NoamB/sorcery'>Sorcery</a>, and finally others like to build their own custom solution. That was something made easier with the inclusion of <code>has_secure_password</code> in Rails 3.1.</p>

<p>That&#8217;s a lot of fragmentation!</p>

<p>Therefore, picking <em>one</em> authentication solution means that we would isolate a large group of people. This is what the &#8220;auth&#8221; component of Spree does, spree_auth.</p>
<hr />
<p>The way that spree_auth deals with authentication is that it uses Devise. It has a <code>Spree::User</code> model in it, and there&#8217;s also some Devise setup inside <code>config/initializers/devise.rb</code>. The <code>Spree::User</code> model is how Spree deals with authentication inside the engine.</p>

<p>By having this authentication inside Spree, we are expressly stating that you <em>must</em> use Devise and have it as a dependency of your application, even if your application uses something completely different.</p>

<p>A bigger problem comes up when your application <em>is also</em> using Devise. <code>spree_auth</code>&#8217;s configuration combined with your application&#8217;s configuration for Devise may cause slowdowns or conflict with each other. This may not happen though, because the railtie&#8217;s (i.e. <code>spree_auth</code>&#8217;s) initializers are run before the application&#8217;s, and so it would take precedence.</p>

<p>For instance, we&#8217;ve had a couple of reports where the Devise configuration in <a href='https://github.com/resolve/refinerycms'>RefineryCMS</a> have been conflicting with Spree&#8217;s authentication.</p>

<p>Finally, by having two different User models (one in the application and one in the engine), it doesn&#8217;t allow users to be shared across the two components. This means that you would need to modify Spree to work with your application or your application to work with Spree, which is not the ideal situation.</p>
<hr />
<p>How we deal with this in Forem is that we simply <em>do not</em> include an authentication engine of any kind. This means that you can use Restful Authentication or Authlogic or Devise or Clearance or Sorcery or something custom and we couldn&#8217;t care less.</p>

<p>The way that this works inside Forem is that we ask two questions when <code>rails g forem:install</code> runs. The first one is effectively &#8220;What is your <code>User</code> class?&#8221; and the second one is &#8220;What is <code>current_user</code> inside your application?&#8221;. Forem then takes these values and inserts code into <code>config/initializers/forem.rb</code> for the <code>Forem.user_class</code> setting and defines a method in the <code>ApplicationController</code> class <em>of the application</em> called <code>forem_user</code> that simply calls the <code>current_user</code> method inside your application.</p>

<p>The <code>Forem.user_class</code> setting is used in a couple of places. Firstly, it&#8217;s used in the <code>Post</code> and <code>Topic</code> models to set up the author/user associations so that we can track who created what topics or posts. Secondly, it&#8217;s used in <code>Forem::ApplicationController</code> for the <code>current_ability</code> method for the CanCan-backed authorization system that Forem uses.</p>

<p>The <code>forem_user</code> method is used to get at the current user of the request and allows Forem to check permissions and determine if a user is logged in or not.</p>

<p>The application, not the engine, is what is providing the authentication engine. The application is <em>God</em> and should always have final say on what is happening, not the engine itself.</p>
<hr />
<p>I personally think Forem&#8217;s approach is the best that we&#8217;re going to get with engines now. This method allows an application to provide the authentication engine and for the engine to hook into it easily enough.</p>

<p>It&#8217;s my thinking that we should remove the <code>spree_auth</code> gem entirely and then rely solely on the application to provide a <code>User</code> (or similar) class. The authentication parts of RefineryCMS (and engines in similar situations) should also be removed. The application is what should have the say on what authentication engine to use, and not an engine.</p>
  </article>
</div>

<div id='archive'>
  <h2>25 back</h2>
  <ul>
    
      <li><a href="/2012/01/free-help">Free Help</a><abbr>31 Jan 2012</abbr></li>
  
      <li><a href="/2012/01/moving-out-down-to-melbourne">Moving Out: Down to Melbourne</a><abbr>09 Jan 2012</abbr></li>
  
      <li><a href="/2011/12/matt-lightner">Matt Lightner</a><abbr>27 Dec 2011</abbr></li>
  
      <li><a href="/2011/12/deciding-what-tests-to-write">Deciding what tests to write</a><abbr>05 Dec 2011</abbr></li>
  
      <li><a href="/2011/11/don-t-print-hard-copies">Don't print hard-copies</a><abbr>29 Nov 2011</abbr></li>
  
      <li><a href="/2011/11/screencast-wrong-argument-type">Screencast: wrong argument type</a><abbr>23 Nov 2011</abbr></li>
  
      <li><a href="/2011/11/the-rails-api">The Rails API</a><abbr>14 Nov 2011</abbr></li>
  
      <li><a href="/2011/11/going-on-a-spree">Going on a Spree</a><abbr>03 Nov 2011</abbr></li>
  
      <li><a href="/2011/10/screencast-pilot">Screencast: Pilot</a><abbr>31 Oct 2011</abbr></li>
  
      <li><a href="/2011/10/that-one-test">That One Test</a><abbr>19 Oct 2011</abbr></li>
  
      <li><a href="/2011/10/leaving-chicago">Leaving Chicago</a><abbr>02 Oct 2011</abbr></li>
  
      <li><a href="/2011/09/learning-and-asking">Learning and Asking</a><abbr>07 Sep 2011</abbr></li>
  
      <li><a href="/2011/09/with-rails-3-1-comes-great-things">With Rails 3.1, comes great things</a><abbr>04 Sep 2011</abbr></li>
  
      <li><a href="/2011/06/sprocket-asset-tags-internals">Sprocket asset tags internals</a><abbr>19 Jun 2011</abbr></li>
  
      <li><a href="/2011/06/the-asset-pipeline">The Asset Pipeline</a><abbr>18 Jun 2011</abbr></li>
  
      <li><a href="/2011/06/mac-os-x-ruby-rvm-rails-and-you">Mac OS X, Ruby, RVM, Rails and You</a><abbr>06 Jun 2011</abbr></li>
  
      <li><a href="/2011/06/a-potential-use-for-asset-pipelining">A potential use for asset pipelining</a><abbr>01 Jun 2011</abbr></li>
  
      <li><a href="/2011/05/the-richest">The Richest</a><abbr>23 May 2011</abbr></li>
  
      <li><a href="/2011/04/whodunit-devise-omniauth-oauth-or-github">Whodunit: Devise, OmniAuth, OAuth or GitHub?</a><abbr>11 Apr 2011</abbr></li>
  
      <li><a href="/2011/04/rails-3-1-in-action">Rails 3.1 in Action</a><abbr>01 Apr 2011</abbr></li>
  
      <li><a href="/2011/03/railscamp-nz">Railscamp NZ</a><abbr>22 Mar 2011</abbr></li>
  
      <li><a href="/2011/03/code-doesn-t-protect-against-stupid">Code doesn't protect against stupid</a><abbr>06 Mar 2011</abbr></li>
  
      <li><a href="/2011/03/when-to-cuke">When to Cuke</a><abbr>03 Mar 2011</abbr></li>
  
      <li><a href="/2011/02/rtfm">RTFM</a><abbr>01 Feb 2011</abbr></li>
  
      <li><a href="/2011/01/rails-3-in-action-50-off">Rails 3 in Action: 50% off</a><abbr>27 Jan 2011</abbr></li>
  
  </ul>
  <center><a href='/blogography.html'>The Complete Blogography</a></center>
</div>

    </div>
    <script type="text/javascript">
      var _gauges = _gauges || [];
      (function() {
        var t   = document.createElement('script');
        t.type  = 'text/javascript';
        t.async = true;
        t.id    = 'gauges-tracker';
        t.setAttribute('data-site-id', '4e30f771f5a1f547c8000001');
        t.src = '//secure.gaug.es/track.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(t, s);
      })();
    </script>
  </body>
</html>
