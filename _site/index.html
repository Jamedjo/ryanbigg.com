<!DOCTYPE HTML>
<html>
  <head>
    <title>Blog of Ryan Bigg - Home</title>
    <link href="http://feeds.feedburner.com/ryanbigg" rel="alternate" title="The Life of a Radar" type="application/atom+xml" />
    <link rel='stylesheet' href='/css/style.css' media='screen'>
    <link rel='stylesheet' href='/css/mobile.css'>
    <link rel='stylesheet' href='/css/ipad.css'>
  <body>
    <h1 align='center'>The Life of a Radar</h1>
    <div id='page'>
      <div id="header">
        <p>Hi there, my parents and friends call me Ryan Bigg, but you may know me as "Radar". Either is fine.</p>
        <p>I'm a technical writer for Ruby / Rails based in Australia. I have written a Rails book with <a href="http://yehudakatz.com">Yehuda Katz</a> called <a href="http://manning.com/katz">Rails 3 in Action</a>, which is available also on <a href='http://www.amazon.com/Rails-3-Action-Ryan-Bigg/dp/1935182277'>Amazon</a>.
        </p>

        <div id="more">
          <p>
          I won a <a href='http://rubyheroes.com'>Ruby Hero</a> award in 2011 for my work on documentation for Rails. I keep some guides in my <a href='http://github.com/radar/guides'>guides</a> repository on GitHub. As part of this documentation, I've worked on the <a href='http://guides.rubyonrails.org/asset_pipeline.html'>Asset Pipeline</a>, <a href='http://guides.rubyonrails.org/active_record_querying.html'>Active Record Query Interface</a>, <a href='http://guides.rubyonrails.org/configuring.html'>Configuring Rails Applications</a>, <a href='http://guides.rubyonrails.org/engines.html'>Getting Started with Engines</a> and the <a href='http://guides.rubyonrails.org/initialization.html'>Rails Initialization Internals</a> guides. I've also been known to hang out on <a href='http://stackoverflow.com/users/15245/ryan-bigg'>Stack Overflow</a>.
          </p>
          <p><strong>If you're a recruiter, thanks but no thanks. Please do not contact me.</strong></p>
          <p> Occasionally I find some time to write interesting blog posts such as the ones you see below.</p>
          <p>I also have done quite a lot of <a href="http://github.com/radar">open-source work</a> and I <a href="http://twitter.com/ryanbigg">tweet</a>. Find out more <a href="http://ryanbigg.com/about-me">about me</a>.</p> 
          <p>If you like what you see you can <a href='http://feeds.feedburner.com/ryanbigg'>subscribe to this blog</a>.</p>
          <p><small>Oh, and I once beat <a href='https://twitter.com/dhh/status/81987522766450688'>DHH</a> in an <a href='https://twitter.com/ryanbigg/status/81988004947828736'>argument</a>.</small></p>
        </div>
      </div>
      <header></header>
      

<!-- Layout inspired by Nick Quaranto's "Litany Against Fear" blog 
     http://litanyagainstfear.com -->
<div id='page'>
  <article>
    <a href="/2012/03/polymorphic-routes"><header>Polymorphic Routes</header></a>
    <small>27 Mar 2012</small><br>
    <p>Really early on in Rails, you would write routes like this:</p>

<pre><code>redirect_to :controller =&gt; &quot;posts&quot;, :action =&gt; &quot;show&quot;, :id =&gt; @post.id</code></pre>

<p>What this would do is dutifully redirect to the <code>show</code> action inside the <code>PostsController</code> and pass along the <code>id</code> parameter with a value of whatever <code>@post.id</code> returns. Typical 302 response.</p>

<p>Then Rails 1.2 came along and allowed you to use routing helpers, like this:</p>

<pre><code>redirect_to post_path(@post)</code></pre>

<p>And the people rejoiced.</p>

<p>This would do effectively the same thing. <code>post_path</code> here would build a route using the <code>@post</code> object that would look something like <code>/posts/1</code> and then <code>redirect_to</code> would send back a 302 response to that route and the browser would follow it.</p>

<p>Then later versions (I can&#8217;t remember which one), allowed syntax like this:</p>

<pre><code>redirect_to @post</code></pre>

<p>And the people rejoiced a second time.</p>

<h3 id='magic_but_not_really'>Magic, but not really</h3>

<blockquote>
<p>Any sufficiently advanced technology is indistinguishable from magic.</p>
</blockquote>

<p>While this seems like magic, it&#8217;s not. What this is doing is actually very, very neat. The <code>redirect_to</code> method, much like its cousins <code>link_to</code> and <code>form_for</code> all use a common method to build URLs, called <code>url_for</code>. The <code>url_for</code> method takes many different varieties of objects, such as strings, hashes or even instances of models, like in the example above.</p>

<p>What it does with these objects then, is quite neat. In the case of the <code>redirect_to @post</code> call above, it inspects the <code>@post</code> object, sees that it is an object of the <code>Post</code> class (we assume, anyway) and checks to see if that object has been persisted in a database somewhere by calling <code>persisted?</code> on it. If it has been persisted, then <code>url_for</code> knows that this object can be found somewhere, and that the place it can be found is most likely under a method called <code>post_path</code>. So it calls this method, and passes in the <code>to_param</code> value of this object which is usually the <code>id</code>.</p>

<p>In short, it&#8217;s effectively doing this:</p>

<pre><code>#{@post.class.downcase}_path(@post.to_param)</code></pre>

<p>Which comes out to being this:</p>

<pre><code>post_path(1)</code></pre>

<p>And when that method is called you would get this little string:</p>

<pre><code>&quot;/posts/1&quot;</code></pre>

<p>Lovely!</p>

<p>This is called <em>polymorphic routing</em>. You can pass an object to methods like <code>redirect_to</code>, <code>link_to</code> and <code>form_for</code> and it will attempt to work out the correct URL of what to use.</p>

<h3 id='the_form_of_form_for'>The form of form_for</h3>

<p>Now, when you&#8217;re coding Rails you may have used <code>form_for</code> like this a very long time ago:</p>

<pre><code>&lt;% form_for @post, :url =&gt; { :controller =&gt; &quot;posts&quot;, :action =&gt; &quot;create&quot; } do |f| %&gt;</code></pre>

<p>Of course, with advancements in Rails you could simplify it to this:</p>

<pre><code>&lt;% form_for @post, :url =&gt; posts_path do |f| %&gt;</code></pre>

<p>Because the form is going to default to having a <code>POST</code> HTTP method and therefore a request to <code>posts_path</code> is going to go to the <code>create</code> action of <code>PostsController</code>, rather than the <code>index</code> action, which is what would result if it were a <code>GET</code> request.</p>

<p>But why stop there? Why not just write this?</p>

<pre><code>&lt;%= form_for @post do |f| %&gt;</code></pre>

<p>Personally, I see no reason not to&#8230; if it&#8217;s something as simple as this. The <code>form_for</code> method uses <code>url_for</code> underneath, just like <code>redirect_to</code> to work out where the form should go. It knows that the <code>@post</code> object is of the <code>Post</code> class (again, we assume) and it checks to see if the object is persisted. If it is, then it will use <code>post_path(@post)</code>. If it&#8217;s not, then <code>posts_path</code>.</p>

<p>The <code>form_for</code> method itself checks to see if the object passed in is persisted also, and if it is then it&#8217;ll default to a <code>PUT</code> HTTP method, otherwise a <code>POST</code>.</p>

<p>So this is how <code>form_for</code> can be flexible enough to have an identical syntax on both a <code>new</code> and <code>edit</code> view. It&#8217;s becoming more and more common these days for people to even put their whole <code>form_for</code> tags into a single partial and include it in both the <code>new</code> and <code>edit</code> pages.</p>

<h3 id='a_more_complex_form'>A more complex form</h3>

<p>So <code>form_for</code> is fairly simple for when you pass a normal object, but what happens if you pass an array of objects? Like this, for instance:</p>

<pre><code>&lt;%= form_for [@post, @comment] do |f| %&gt;</code></pre>

<p>Well, both <code>url_for</code> and <code>form_for</code> have you covered there too.</p>

<p>The <code>url_for</code> method detects that this is an array and separates out each part and inspects them individually. First, what is this <code>@post</code> thing? Well, in this case let&#8217;s assume it&#8217;s a <code>Post</code> instance that <em>is</em> persisted and has the id of 1. Second, what is this <code>@comment</code> object? It&#8217;s a <code>Comment</code> instance that has not yet been persisted to the database.</p>

<p>What <code>url_for</code> will do here is build up the URL helper method piece by piece by placing each part in an array, joining it into a routing method and then calling that routing method with the necessary arguments.</p>

<p>First, it knows that the <code>@post</code> object is of the <code>Post</code> class and is persisted, therefore the URL helper will begin with <code>post</code>. Second, it knows that the <code>@comment</code> object is of the <code>Comment</code> class and is <em>not</em> persisted, and therefore <code>comments</code> will follow <code>post</code> in the URL helper build. The parts that <code>url_for</code> now knows about are <code>[:post, :comments]</code>.</p>

<p>The <code>url_for</code> method combines these individual parts with an underscore, so that it becomes <code>post_comments</code> and then appends <code>_path</code> to the end of that, resulting in <code>post_comments_path</code>. Then it passes in just the persisted objects to the call to that method, resulting in a call like this:</p>

<pre><code>post_comments_path(@post)</code></pre>

<p>Calling that method results in this:</p>

<pre><code>&quot;/posts/1/comments&quot;</code></pre>

<p>Best part? <code>form_for</code> will still know to use <code>POST</code> if the <code>@comment</code> object is not a persisted object, and <code>PUT</code> if it is. A good thing to remember is that the <code>form_for</code> is always for the <em>last</em> object specified in the array. The objects prior to it are just its nesting, nothing more.</p>

<p>The more objects that are added, the more times <code>url_for</code> will do the hard yards and build the path out&#8230; although I recommend that you keep it to just two parts.</p>

<h3 id='a_symbolic_form'>A symbolic form</h3>

<p>Now that we&#8217;ve covered using an array containing objects for <code>form_for</code>, let&#8217;s take a look at another common use. An array containing at least one Symbol object, like this:</p>

<pre><code>&lt;%= form_for [:admin, @post, @comment] do |f| %&gt;</code></pre>

<p>What the <code>url_for</code> method does here is very simple. It sees that there&#8217;s a <code>Symbol</code> and takes it as it is. The first part of the <code>url</code> will simply be the same as the symbol: <code>admin</code>. The URL that <code>url_for</code> knows of at this point is just <code>[:admin]</code>.</p>

<p>Then <code>url_for</code> goes through the remaining parts of the array. In this case, let&#8217;s assume both <code>@post</code> and <code>@comment</code> are persisted and that they have the ids of 1 and 2 respectively. Same classes as before. <code>url_for</code> then adds <code>post</code> to the URL that it&#8217;s building, and <code>comment</code> too, resulting in <code>[:admin, :post, :comment]</code>.</p>

<p>Then the joining happens, resulting in a method of <code>admin_post_comment_path</code>, and because both <code>@post</code> and <code>@comment</code> are persisted here, they&#8217;re passed in, resulting in this method call:</p>

<pre><code>admin_post_comment_path(@post, @comment)</code></pre>

<p>Which (usually) turns into this path:</p>

<pre><code>/admin/posts/1/comments/2</code></pre>

<h3 id='conclusion'>Conclusion</h3>

<p>You can use the array form of polymorphic routing with the <code>redirect_to</code>, <code>link_to</code> and <code>form_for</code> methods. There&#8217;s probably other methods that I&#8217;m not remembering right now that can do it too&#8230; it&#8217;s generally anything in Rails that would normally take a URL.</p>

<p>There&#8217;s no need to build your URLs in any Rails version greater-than 2 using hashes; that&#8217;s pretty old school.</p>

<p>Instead, experiment with your new knowledge of polymorphic routing and use it to the best of your advantage.</p>
  </article>
</div>

<div id='archive'>
  <h2>25 back</h2>
  <ul>
    
      <li><a href="/2012/03/please-learn-rails">Please learn Rails</a><abbr>17 Mar 2012</abbr></li>
  
      <li><a href="/2012/03/frontier-we-need-to-talk">Frontier, we need to talk</a><abbr>14 Mar 2012</abbr></li>
  
      <li><a href="/2012/03/engines-and-authentication">Engines and Authentication</a><abbr>03 Mar 2012</abbr></li>
  
      <li><a href="/2012/01/free-help">Free Help</a><abbr>31 Jan 2012</abbr></li>
  
      <li><a href="/2012/01/moving-out-down-to-melbourne">Moving Out: Down to Melbourne</a><abbr>09 Jan 2012</abbr></li>
  
      <li><a href="/2011/12/matt-lightner">Matt Lightner</a><abbr>27 Dec 2011</abbr></li>
  
      <li><a href="/2011/12/deciding-what-tests-to-write">Deciding what tests to write</a><abbr>05 Dec 2011</abbr></li>
  
      <li><a href="/2011/11/don-t-print-hard-copies">Don't print hard-copies</a><abbr>29 Nov 2011</abbr></li>
  
      <li><a href="/2011/11/screencast-wrong-argument-type">Screencast: wrong argument type</a><abbr>23 Nov 2011</abbr></li>
  
      <li><a href="/2011/11/the-rails-api">The Rails API</a><abbr>14 Nov 2011</abbr></li>
  
      <li><a href="/2011/11/going-on-a-spree">Going on a Spree</a><abbr>03 Nov 2011</abbr></li>
  
      <li><a href="/2011/10/screencast-pilot">Screencast: Pilot</a><abbr>31 Oct 2011</abbr></li>
  
      <li><a href="/2011/10/that-one-test">That One Test</a><abbr>19 Oct 2011</abbr></li>
  
      <li><a href="/2011/10/leaving-chicago">Leaving Chicago</a><abbr>02 Oct 2011</abbr></li>
  
      <li><a href="/2011/09/learning-and-asking">Learning and Asking</a><abbr>07 Sep 2011</abbr></li>
  
      <li><a href="/2011/09/with-rails-3-1-comes-great-things">With Rails 3.1, comes great things</a><abbr>04 Sep 2011</abbr></li>
  
      <li><a href="/2011/06/sprocket-asset-tags-internals">Sprocket asset tags internals</a><abbr>19 Jun 2011</abbr></li>
  
      <li><a href="/2011/06/the-asset-pipeline">The Asset Pipeline</a><abbr>18 Jun 2011</abbr></li>
  
      <li><a href="/2011/06/mac-os-x-ruby-rvm-rails-and-you">Mac OS X, Ruby, RVM, Rails and You</a><abbr>06 Jun 2011</abbr></li>
  
      <li><a href="/2011/06/a-potential-use-for-asset-pipelining">A potential use for asset pipelining</a><abbr>01 Jun 2011</abbr></li>
  
      <li><a href="/2011/05/the-richest">The Richest</a><abbr>23 May 2011</abbr></li>
  
      <li><a href="/2011/04/whodunit-devise-omniauth-oauth-or-github">Whodunit: Devise, OmniAuth, OAuth or GitHub?</a><abbr>11 Apr 2011</abbr></li>
  
      <li><a href="/2011/04/rails-3-1-in-action">Rails 3.1 in Action</a><abbr>01 Apr 2011</abbr></li>
  
      <li><a href="/2011/03/railscamp-nz">Railscamp NZ</a><abbr>22 Mar 2011</abbr></li>
  
      <li><a href="/2011/03/code-doesn-t-protect-against-stupid">Code doesn't protect against stupid</a><abbr>06 Mar 2011</abbr></li>
  
  </ul>
  <center><a href='/blogography.html'>The Complete Blogography</a></center>
</div>

    </div>
    <script type="text/javascript">
      var _gauges = _gauges || [];
      (function() {
        var t   = document.createElement('script');
        t.type  = 'text/javascript';
        t.async = true;
        t.id    = 'gauges-tracker';
        t.setAttribute('data-site-id', '4e30f771f5a1f547c8000001');
        t.src = '//secure.gaug.es/track.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(t, s);
      })();
    </script>
  </body>
</html>
