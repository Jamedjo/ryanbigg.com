<!DOCTYPE HTML>
<html>
  <head>
    <title>Blog of Ryan Bigg - Adding Your Own Differ to RSpec</title>
    <link href="http://feeds.feedburner.com/ryanbigg" rel="alternate" title="The Life of a Radar" type="application/atom+xml" />
    <link rel='stylesheet' href='/css/style.css' media='screen'>
    <link rel='stylesheet' href='/css/mobile.css'>
  <body>
    <h1 align='center'><a href='http://ryanbigg.com'>The Life of a Radar</a></h1>
    <div id='page'>
      <article>
        <a href="/2009/07/adding-your-own-differ-to-rspec"><header>Adding Your Own Differ to RSpec</header></a>
        <small>17 Jul 2009</small><br>
        <p>Recently I <a href='https://rspec.lighthouseapp.com/projects/5645/tickets/848-diff_as_hash'>added diff_as_hash to rspec</a> and I&#8217;d like to show you what I did, so you can add your own differs, and it&#8217;s only a couple of lines of code. You can edit your own local gem copy of rspec using the find_gem gem&#8217;s edit_gem command.</p>

<p>Let&#8217;s use the example that you want to add a BigDecimal differ.</p>
<h3><em>lib/spec/expectations/fail_with.rb</em></h3>
<p>First of all you&#8217;re going to need to add a line to this file, something that looks like the lines here, along with the other <span class='term'>elsif</span>s:</p>
<script src='http://gist.github.com/148909.js' /><h3><em>lib/spec/runner/differs/default.rb</em></h3>
<p>Secondly, in this file inside the <span class='term'>Spec::Expectations::Differs::Default</span> class you&#8217;ll have to define your <span class='term'>diff_as_big_decimal</span> differ:</p>
<script src='http://gist.github.com/148912.js' />
<p>Now when you diff BigDecimal numbers in your rspec tests, you&#8217;ll see this output, rather than the ugly output.</p>

<p>However, what would be nicer is if you could expand on this diffing syntax in your own project, rather than having to hack rspec and have it wiped next time you upgrade. More on that later though.</p>
      </article>
    </div>
    <div id='disqus_thread'></div>
    <script type="text/javascript">
        var disqus_shortname = 'ryanbigg'; // required: replace example with your forum shortname

        var disqus_identifier = '666 http://ryanbigg.com/?p=666'
        var disqus_url = 'http://ryanbigg.com/2009/07/adding-your-own-differ-to-rspec';

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-396182-13");
    pageTracker._setDomainName("none");
    pageTracker._setAllowLinker(true);
    pageTracker._trackPageview();
    } catch(err) {}</script>    
  </body>
</html>
